source /home/asura/.vim/my_plugin/statusline.vim
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" é€šç”¨è®¾ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let mapleader = ' '   " å®šä¹‰<leader>é”®
set nocompatible      " è®¾ç½®ä¸å…¼å®¹åŸå§‹viæ¨¡å¼
filetype on           " è®¾ç½®å¼€å¯æ–‡ä»¶ç±»å‹ä¾¦æµ‹
filetype plugin on    " è®¾ç½®åŠ è½½å¯¹åº”æ–‡ä»¶ç±»å‹çš„æ’ä»¶
set noeb              " å…³é—­é”™è¯¯çš„æç¤º
syntax enable         " å¼€å¯è¯­æ³•é«˜äº®åŠŸèƒ½
syntax on             " è‡ªåŠ¨è¯­æ³•é«˜äº®
set t_Co=256          " å¼€å¯256è‰²æ”¯æŒ
set showcmd           " selectæ¨¡å¼ä¸‹æ˜¾ç¤ºé€‰ä¸­çš„è¡Œæ•°
set ruler             " æ€»æ˜¯æ˜¾ç¤ºå…‰æ ‡ä½ç½®
set laststatus=2      " æ€»æ˜¯æ˜¾ç¤ºçŠ¶æ€æ 
set number            " å¼€å¯è¡Œå·æ˜¾ç¤º
set cursorline        " é«˜äº®æ˜¾ç¤ºå½“å‰è¡Œ
set ttimeoutlen=0     " è®¾ç½®<ESC>é”®å“åº”æ—¶é—´
" set virtualedit=all                " å…è®¸å…‰æ ‡å‡ºç°åœ¨æœ€åä¸€ä¸ªå­—ç¬¦çš„åé¢
set autochdir         " æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨ cd åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•
set noshowmode        " ä¸æ˜¾ç¤ºå·¦ä¸‹è§’çŠ¶æ€æ 
set clipboard=unnamed " system clipboard
let autosave=0        " autosave
set showmatch         " é«˜äº®æ ‡è¯†åŒ¹é…çš„æ‹¬å·
set scrolloff=5       " å…‰æ ‡è·ç¦»çª—å£ä¸Šä¸‹ä¿ç•™5è¡Œ
" set spell spelllang=en_us          " å¼€å¯å†…ç½®æ‹¼å†™æ£€æŸ¥
set undofile          " å†å²è®°å½•

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ä»£ç ç¼©è¿›å’Œæ’ç‰ˆ
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
set autoindent                 "  è®¾ç½®è‡ªåŠ¨ç¼©è¿›
set cindent                    "  è®¾ç½®ä½¿ç”¨C/C++è¯­è¨€çš„è‡ªåŠ¨ç¼©è¿›æ–¹å¼
set cinoptions=g0,:0,N-s,(0    "  è®¾ç½®C/C++è¯­è¨€çš„å…·ä½“ç¼©è¿›æ–¹å¼
set smartindent                "  æ™ºèƒ½çš„é€‰æ‹©å¯¹å…¶æ–¹å¼
filetype indent on             "  è‡ªé€‚åº”ä¸åŒè¯­è¨€çš„æ™ºèƒ½ç¼©è¿›
filetype plugin indent on      "  enables filetype detection
"set expandtab                  "  å°†åˆ¶è¡¨ç¬¦æ‰©å±•ä¸ºç©ºæ ¼
set tabstop=4                  "  è®¾ç½®ç¼–è¾‘æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set shiftwidth=4               "  è®¾ç½®æ ¼å¼åŒ–æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set softtabstop=4              "  è®¾ç½®4ä¸ªç©ºæ ¼ä¸ºåˆ¶è¡¨ç¬¦
set smarttab                   "  åœ¨è¡Œå’Œæ®µå¼€å§‹å¤„ä½¿ç”¨åˆ¶è¡¨ç¬¦
"set nowrap                     "  ç¦æ­¢æŠ˜è¡Œ
set backspace=indent,eol,start "  ä½¿ç”¨å›è½¦é”®æ­£å¸¸å¤„ç†indent,eol,startç­‰
set sidescroll=10              "  è®¾ç½®å‘å³æ»šåŠ¨å­—ç¬¦æ•°
set nofoldenable               "  ç¦ç”¨æŠ˜å ä»£ç 

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ä»£ç è¡¥å…¨
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
set wildmenu                         "  vimè‡ªèº«å‘½åè¡Œæ¨¡å¼æ™ºèƒ½è¡¥å…¨
set completeopt=longest,menu,menuone "  è¡¥å…¨æ—¶ä¸æ˜¾ç¤ºçª—å£ï¼Œåªæ˜¾ç¤ºè¡¥å…¨åˆ—è¡¨

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" æœç´¢è®¾ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
set hlsearch   "  é«˜äº®æ˜¾ç¤ºæœç´¢ç»“æœ
set incsearch  "  å¼€å¯å®æ—¶æœç´¢åŠŸèƒ½
set ignorecase "  æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ
set smartcase  "  æœç´¢æ—¶ï¼Œæ™ºèƒ½å¤§å°å†™

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ç¼“å­˜è®¾ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
set nobackup            " è®¾ç½®ä¸å¤‡ä»½
set noswapfile          " ç¦æ­¢ç”Ÿæˆä¸´æ—¶æ–‡ä»¶
set autoread            " æ–‡ä»¶åœ¨vimä¹‹å¤–ä¿®æ”¹è¿‡ï¼Œè‡ªåŠ¨é‡æ–°è¯»å…¥
set autowrite           " è®¾ç½®è‡ªåŠ¨ä¿å­˜
set confirm             " åœ¨å¤„ç†æœªä¿å­˜æˆ–åªè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œå¼¹å‡ºç¡®è®¤

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ç¼–ç è®¾ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
set langmenu=zh_CN.UTF-8
set helplang=cn
set termencoding=utf-8
set encoding=utf8
set fileencodings=utf8,ucs-bom,gbk,cp936,gb2312,gb18030
set fenc=utf-8

" write with sudo
cabbrev w!! w !sudo tee %


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" æ’ä»¶åˆ—è¡¨
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
call plug#begin('~/.vim/plugged')
Plug 'tpope/vim-fugitive'
Plug 'zivyangll/git-blame.vim'
Plug 'scrooloose/nerdtree'
Plug 'jistr/vim-nerdtree-tabs'
Plug 'iamcco/mathjax-support-for-mkdp'
Plug 'iamcco/markdown-preview.vim'
"Plug 'sillybun/vim-autodoc'
Plug 'Yggdroot/indentLine'
Plug 'Valloric/YouCompleteMe'
Plug 'davidhalter/jedi-vim'
Plug 'ekalinin/Dockerfile.vim'
"Plug 'vim-airline/vim-airline'
"Plug 'vim-airline/vim-airline-themes'
Plug 'vim-scripts/taglist.vim'
Plug 'ryanoasis/vim-devicons'
Plug 'godlygeek/tabular'
Plug 'skywind3000/asyncrun.vim'
Plug 'w0rp/ale'
"Plug 'sillybun/vim-repl'
Plug 'vimwiki/vimwiki'
Plug 'mbbill/undotree'
Plug 'SirVer/ultisnips'
Plug 'honza/vim-snippets'
Plug 'z0mbix/vim-shfmt' , { 'for': 'sh' }
Plug 'ervandew/supertab'
Plug '~/.fzf'
Plug 'junegunn/fzf.vim'
" color
Plug 'arcticicestudio/nord-vim'
Plug 'liuchengxu/space-vim-dark'
Plug 'drewtempelmeyer/palenight.vim'
Plug 'ayu-theme/ayu-vim'
Plug 'rakr/vim-one'
Plug 'mhartington/oceanic-next'
Plug 'joshdick/onedark.vim'
call plug#end()

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-airline ç¾åŒ–çŠ¶æ€æ 
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" let g:airline#extensions#tabline#enabled = 1 " æ˜¯å¦æ‰“å¼€tabline
" "let g:airline#extensions#tabline#left_sep = 'î‚°'
" "let g:airline#extensions#tabline#left_alt_sep = 'î‚±'
" let g:airline_theme='papercolor'
" "let g:airline_section_c = '%<%F%m %#__accent_red#%{airline#util#wrap(airline#parts#readonly(),0)}%#__restore__#' " åœ¨çŠ¶æ€è¡Œä¸­æ˜¾ç¤ºç»å¯¹æ–‡ä»¶è·¯å¾„
" let g:asyncrun_status = ''
" let g:airline_section_error = airline#section#create_right(['%{g:asyncrun_status}'])
" let g:airline#extensions#tabline#tab_nr_type = 1 " åœ¨æ ‡ç­¾è¡Œä¸­æ˜¾ç¤ºæ ‡ç­¾å·
" let g:airline_powerline_fonts = 1
" let g:airline#extensions#tabline#show_tab_nr = 1
" let g:airline#extensions#tabline#formatter = 'default'
" let g:airline#extensions#tabline#buffer_nr_show = 1 " tablineä¸­bufferæ˜¾ç¤ºç¼–å·
" let g:airline#extensions#tabline#fnametruncate = 16
" let g:airline#extensions#tabline#fnamecollapse = 2
" let g:airline#extensions#tabline#buffer_idx_mode = 1
"
" if !exists('g:airline_symbols')
"   let g:airline_symbols = {}
" endif
"
" " powerline symbols
" "let g:airline_left_sep = 'î‚°'
" "let g:airline_left_alt_sep = 'î‚±'
" "let g:airline_right_sep = 'î‚²'
" "let g:airline_right_alt_sep = 'î‚³'
" "let g:powerline_symbls = 'unicode'
" let g:airline_symbols.branch = 'î‚ '
" let g:airline_symbols.readonly = 'î‚¢'
" let g:airline_symbols.linenr = 'î‚¡'
" let g:airline_symbols.crypt = 'ğŸ”’'
" let g:airline_symbols.paste = 'Ï'
" let g:airline_symbols.notexists = 'âˆ„'
" let g:airline_symbols.whitespace = 'Î'
" let g:airline_detect_modified = 1
" let g:airline_detect_paste = 1

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Colors çš®è‚¤
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"set term=xterm-256color
"let &t_8f = "\<Esc>[38;2;%lu;%lu;%lum"
"let &t_8b = "\<Esc>[48;2;%lu;%lu;%lum"
"set termguicolors
let g:onedark_termcolors=256
let g:onedark_color_overrides = {"black": {"gui": "#1F2D3A", "cterm": "NONE", "cterm16": "0"}}
color onedark
hi CursorLine cterm=NONE ctermbg=black ctermfg=NONE guibg=black guifg=NONE " è®¾ç½®è¡Œé«˜äº®é¢œè‰²
hi Search cterm=NONE ctermfg=NONE ctermbg=8 " è®¾ç½®æœç´¢é«˜äº®é¢œè‰²
hi Visual cterm=NONE ctermfg=NONE ctermbg=0 " è®¾ç½®Visual æ¨¡å¼é«˜äº®é¢œè‰²
hi BadWhitespace ctermbg=red guibg=red " ä½¿ç”¨çº¢è‰²æ˜¾ç¤ºå¤šä½™ç©ºæ ¼


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" YouCompleteMe ä»£ç è¡¥å…¨
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"autocomplete
let g:ycm_add_preview_to_completeopt = 0
let g:ycm_autoclose_preview_window_after_completion = 1
let g:ycm_autoclose_preview_window_after_insertion = 1        " ç¦»å¼€æ’å…¥æ¨¡å¼è‡ªåŠ¨å…³é—­è¡¥å…¨
let g:ycm_cache_omnifunc = 0                                  " ç¦æ­¢ç¼“å­˜åŒ¹é…é¡¹ï¼Œæ¯æ¬¡éƒ½é‡æ–°ç”ŸæˆåŒ¹é…é¡¹
let g:ycm_collect_identifiers_from_comments_and_strings = 0   " æ³¨é‡Šå’Œå­—ç¬¦ä¸²ä¸­çš„æ–‡å­—è¡¥å…¨
let g:ycm_collect_identifiers_from_tags_files = 1             " YCMåŸºäºæ ‡ç­¾å¼•æ“è¡¥å…¨
let g:ycm_complete_in_comments = 1                            " æ³¨é‡Šè¡¥å…¨
let g:ycm_complete_in_strings = 1                             " å­—ç¬¦ä¸²è¡¥å…¨
let g:ycm_confirm_extra_conf = 0
let g:ycm_global_ycm_extra_conf = '~/.vim/.ycm_extra_conf.py'
let g:ycm_goto_buffer_command = 'horizontal-split'            " ä¸°å®ç°å’Œå£°æ˜ä¹‹é—´è·³è½¬ï¼Œå¹¶åˆ†å±æ‰“å¼€
let g:ycm_min_num_of_chars_for_competion = 2                  " ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹è¡¥å…¨
let g:ycm_python_binary_path = 'python'
let g:ycm_seed_indetifiers_with_syntax = 1                    " è¯­æ³•å…³é”®å­—è¡¥å…¨
let g:ycm_server_log_level = 'info'
let g:ycm_server_python_interpreter='/usr/bin/python'
let g:ycm_show_diagnostcs_ui = 0
"let g:ycm_use_ultisnips_completer = 1                         " æ•´åˆUltiSnipsçš„æç¤º
"youcompleteme  é»˜è®¤tab  s-tab å’Œè‡ªåŠ¨è¡¥å…¨å†²çª
"let g:ycm_key_list_select_completion = ['<Enter>', '<Down>']
"let g:ycm_key_list_previous_completion = ['<S-TAB>', '<Up>']
let g:ycm_key_list_select_completion = ['<Down>']
let g:ycm_key_list_previous_completion = ['<Up>']
noremap <c-z> <NOP>
let g:ycm_key_invoke_completion= '<c-z>'
autocmd InsertLeave * if pumvisible() == 0|pclose|endif " ç¦»å¼€æ’å…¥æ¨¡å¼åè‡ªåŠ¨å…³é—­é¢„è§ˆçª—å£
"inoremap <expr> <CR>       pumvisible() ? '<C-y>' : '\<CR>' "å’Œå…¶ä»–æ’ä»¶æœ‰å†²çª
map <leader>g  :YcmCompleter GoToDefinitionElseDeclaration<CR>
let g:ycm_semantic_triggers =  {
			\ 'c,cpp,python,java,go,erlang,perl': ['re!\w{2}'],
			\ 'cs,lua,javascript': ['re!\w{2}'],
			\ }
let g:ycm_filetype_whitelist = {
			\ 'c':1,
			\ 'cpp':1,
			\ 'php':1,
			\ 'python':1,
			\ 'sh':1,
			\ 'yaml':1,
			\ 'zsh':1,
			\ }

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" python è™šæ‹Ÿç¯å¢ƒæ”¯æŒ
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
py << EOF
import os
import sys
if 'VIRTUAL_ENV' in os.environ:
  project_base_dir = os.environ['VIRTUAL_ENV']
  activate_this = os.path.join(project_base_dir, 'bin/activate_this.py')
  execfile(activate_this, dict(__file__=activate_this))
EOF

"it would be nice to set tag files by the active virtualenv here
":set tags=~/mytags "tags for ctags and taglist
"omnicomplete
autocmd FileType python set omnifunc=jedi#completions
"autocmd FileType python set omnifunc=pythoncomplete#Complete

hi pythonSelf  ctermfg=68  guifg=#5f87d7 cterm=bold gui=bold

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" python pep8
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" Display tabs at the beginning of a line in Python mode as bad.
au BufRead,BufNewFile *.py,*.pyw match BadWhitespace /^\t\+/
" Make trailing whitespace be flagged as bad.
au BufRead,BufNewFile *.py,*.pyw,*.c,*.h match BadWhitespace /\s\+$/

" Wrap text after a certain number of characters
au BufRead,BufNewFile *.py,*.pyw, set textwidth=100

" Use UNIX (\n) line endings.
au BufNewFile *.py,*.pyw,*.c,*.h set fileformat=unix

autocmd BufNewFile,BufRead *.md,*.markdown,*.mmd  nested setlocal filetype=markdown

" for different file types
augroup filetype_formats
  au!

  au FileType help setlocal nu

  au BufNewFile,BufRead *.{vim,vimrc}
        \ setlocal foldmethod=marker |
        \ setlocal tabstop=2         |
        \ setlocal softtabstop=2     |
        \ setlocal shiftwidth=2

  au BufNewFile,BufRead *.py
       \ setlocal autoindent      |
       \ setlocal nowrap          |
       \ setlocal sidescroll=5    |
       \ let g:python_highlight_all = 1 |
       \ setlocal complete+=t |
       \ setlocal formatoptions-=t |
       \ setlocal commentstring=#%s |
       \ setlocal define=^\s*\\(def\\\\|class\\)
       " \ set listchars+=precedes:<,extends:>
       \ set textwidth=79 |

  au BufNewFile,BufRead *.js,*.html,*.css,*.yml
      \ setlocal tabstop=2     |
      \ setlocal softtabstop=2 |
      \ setlocal shiftwidth=2

  " useless whitespaces
  au BufRead,BufNewFile *.py,*.pyw,*.c,*.h,*.{vim,vimrc}
      \ highlight BadWhitespace ctermbg=red guibg=darkred |
      \ match BadWhitespace /\s\+$/

augroup END

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" NERDTree æ–‡ä»¶æµè§ˆ
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
map <F2> :NERDTreeToggle<CR>

augroup nerd_behaviours
  au!
  autocmd StdinReadPre * let s:std_in = 1
  autocmd VimEnter * if argc() == 1 && isdirectory(argv()[0]) && !exists("s:std_in") | exe 'NERDTree' argv()[0] | wincmd p | ene | endif
  autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree() && b:NERDTreeType == "primary") | q | endif
  autocmd tableave * if exists('g:loaded_nerd_tree') | execute 'NERDTreeClose' | endif
augroup END

let NERDTreeIgnore=['\.pyc$', '\~$', '\.swp', '__pycache__[[dir]]']
let NERDTreeShowBookmarks=1
let g:nerdtree_tabs_open_on_console_startup=0
let g:NERDTreeIndicatorMapCustom = {
    \ "Modified"  : "âœ¹",
    \ "Staged"    : "âœš",
    \ "Untracked" : "âœ­",
    \ "Renamed"   : "âœ",
    \ "Unmerged"  : "â•",
    \ "Deleted"   : "âœ–",
    \ "Dirty"     : "âœ—",
    \ "Clean"     : "âœ”ï¸",
    \ "Unknown"   : "?"
    \ }
let NERDTreeCascadeSingleChildDir=0
let g:NERDTreeNaturalSort = 1
let g:NERDTreeShowLineNumbers = 0
let g:NERDTreeShowHidden = 1

""""""""""""""""""""""""""""""""""""""
"Quickly Run
"""""""""""""""""""""""""""""""""""""
nnoremap <F5> :call <SID>compile_and_run()<CR>
func! s:compile_and_run()
	exec 'w'
	if &filetype ==# 'c'
		exec 'gcc -o3 % -o %<'
		exec '!time ./%<'
	elseif &filetype ==# 'cpp'
		exec '!g++ -o3 % -o %<'
		exec '!time ./%<'
	elseif &filetype ==# 'java'
		exec '!javac %'
		exec '!time java %<'
	elseif &filetype ==# 'sh'
		exec 'AsyncRun! time bash %'
	elseif &filetype ==# 'python'
		if search('@profile')
			exec 'AsyncRun kernprof -l -v %'
			exec 'copen'
			exec 'wincmd p'
		elseif search('set_trace()')
			exec '!python3 %'
		else
			exec 'AsyncRun -raw python3 %'
			exec 'copen'
			exec 'wincmd p'
		endif
	elseif &filetype ==# 'html'
		exec '!firefox % &'
	elseif &filetype ==# 'go'
		' exec '!go build %<'
		exec '!time go run %'
" 	elseif &filetype ==# 'md'
" 		exec '!~/.vim/markdown.pl % > %.html &'
" 		exec 'AsyncRun chromium %.html %'
	endif
endfunc

" æ‰“å¼€æ—¶å…‰æ ‡æ”¾åœ¨ä¸Šæ¬¡é€€å‡ºæ—¶çš„ä½ç½®
autocmd BufReadPost *
            \ if line("'\"") > 0 && line("'\"") <= line("$") |
            \   exe "normal! g`\"" |
            \ endif

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" Taglist æµè§ˆä»£ç å‡½æ•°
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" let Tlist_Show_One_File=1    "åªæ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„tags
let Tlist_WinWidth=40        "è®¾ç½®taglistå®½åº¦
let Tlist_Exit_OnlyWindow=1  "tagListçª—å£æ˜¯æœ€åä¸€ä¸ªçª—å£ï¼Œåˆ™é€€å‡ºVim
let Tlist_Use_Right_Window=1 "åœ¨Vimçª—å£å³ä¾§æ˜¾ç¤ºtaglistçª—å£
map <F4> :TlistToggle<CR>


let tlist_vimwiki_settings = 'wiki;h:Headers'
let tlist_confluencewiki_settings = 'confluencewiki;h:Headers'
let tlist_markdown_settings = 'markdown;h:Headers'
let tlist_textile_settings = 'textile;h:Headers'
let tlist_html_settings = 'html;h:Headers;o:Objects(ID);c:Classes'
let tlist_xhtml_settings = 'html;h:Headers;o:Objects(ID);c:Classes'
let tlist_velocity_settings = 'html;h:Headers;o:Objects(ID);c:Classes'
let tlist_css_settings = 'css;c:Classes;o:Objects(ID);t:Tags(Elements)'
let tlist_javascript_settings = 'javascript;f:Functions;c:Classes;o:Objects'
let tlist_json_settings = 'json;o:Objects'

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" indentLine
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:indentLine_char='|'
let g:indentLine_enabled = 1
let g:indentLine_color_term = 239
let g:indentLine_color_gui = '#A4E57E'

function! RemoveTrailingWhitespace()
    if &ft != "diff"
        let b:curcol = col(".")
        let b:curline = line(".")
        silent! %s/\s\+$//
        silent! %s/\(\s*\n\)\+\%$//
        call cursor(b:curline, b:curcol)
    endif
endfunction
autocmd BufWritePre * call RemoveTrailingWhitespace()

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vim-devicons æ–‡ä»¶å›¾æ ‡
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:webdevicons_enable=1
let g:webdevicons_enable_nerdtree=1
" let g:webdevicons_enables_airline_tabline=1
" let g:webdevicons_enable_airline_statusline=1
let g:WebDevIconsUnicodeDecorateFolderNodes=1
let g:DevIconsEnableFoldersOpenClose=1

" python autopep8
autocmd FileType python noremap <buffer> <F8> :call Autopep8()<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ale ä»£ç æ£€æŸ¥
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" æ˜¾ç¤ºä¾§è¾¹æ 
let g:ale_sign_column_always = 1
let g:ale_set_highlights = 0
let g:ale_fix_on_save = 0
let g:ale_linters_explicit = 1
let g:ale_sign_error = 'âœ—'
let g:ale_sign_warning = 'âš¡'
"let g:airline#extensions#ale#enabled = 1
let g:ale_statusline_format = ['â¨‰ %d', 'âš  %d', 'â¬¥ ok']
"æ”¹å˜çŠ¶æ€æ ä¿¡æ¯æ ¼å¼
"æ”¹å˜å‘½ä»¤è¡Œæ¶ˆæ¯
let g:ale_echo_msg_error_str = 'E'
let g:ale_echo_msg_warning_str = 'W'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let g:ale_linters = {
			\ 'bash':['shellcheck'],
			\ 'ansible':['ansible-lint'],
			\ 'dockerfile':['hadolint'],
			\ 'markdown':['alex'],
			\ 'python':['flake8'],
			\ 'vim':['vint'],
			\ 'yaml':['yamllint'],
			\}
let g:ale_lint_on_text_changed = 'normal'
let g:ale_lint_on_insert_leave = 1

autocmd FileType python noremap <buffer> <F7> :ALEFix<CR>

let g:ale_fixers = {
    \ 'python': ['autopep8', 'yapf'],
    \ 'bash': ['shfmt'],
    \ }
"æ™®é€šæ¨¡å¼ä¸‹ï¼Œspå‰å¾€ä¸Šä¸€ä¸ªé”™è¯¯æˆ–è­¦å‘Šï¼Œsnå‰å¾€ä¸‹ä¸€ä¸ªé”™è¯¯æˆ–è­¦å‘Š
nmap sp <Plug>(ale_previous_wrap)
nmap sn <Plug>(ale_next_wrap)
"<Leader>d æŸ¥çœ‹é”™è¯¯æˆ–è­¦å‘Šçš„è¯¦ç»†ä¿¡æ¯
nmap <Leader>d :ALEDetail<CR>

" repl
"autocmd Filetype python nnoremap <leader>r :REPLToggle<Cr>
"
"let g:rep_row_width = 10            " çª—å£å®½åº¦
"let g:sendtorepl_invoke_key = 'ww'  " ä¼ é€ä»£ç å¿«æ·é”®ï¼Œé»˜è®¤ww
"let g:repl_at_top = 0               " 0æ ‡è¯†å‡ºç°åœ¨ä¸‹æ–¹ï¼Œ1æ ‡è¯†å‡ºç°åœ¨ä¸Šæ–¹
"let g:repl_stayatrepl_when_open = 0 " æ‰“å¼€REPLæ—¶æ˜¯å›åˆ°æºæ–‡ä»¶ (1) è¿˜æ˜¯åœç•™åœ¨REPLçª—å£ä¸­ (0)
"let g:repl_program = {
"			\ 'python': 'ipython3',
"			\ 'default': 'zsh',
"			\}
"let g:repl_exit_commands = {
"			\ 'python': 'quit()',
"			\ 'bash': 'exit',
"			\ 'zsh': 'exit',
"			\ 'default': 'exit',
"			\}

" auto load vimrc
" autocmd BufWritePost $MYVIMRC source $MYVIMRC

" git blame
nmap <Leader>c :<C-u>call gitblame#echo()<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" vimwiki wikiå·¥å…·
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:vimwiki_menu = '' " ä¸åœ¨èœå•æ æ˜¾ç¤ºVimwiki
let g:vimwiki_diary_months = {
    \ 1: 'ä¸€æœˆ', 2: 'äºŒæœˆ', 3: 'ä¸‰æœˆ', 4: 'å››æœˆ', 5: 'äº”æœˆ', 6: 'å…­æœˆ',
    \ 7: 'ä¸ƒæœˆ', 8: 'å…«æœˆ', 9: 'ä¹æœˆ', 10: 'åæœˆ', 11: 'åä¸€æœˆ', 12: 'åäºŒæœˆ'
    \ }
let g:vimwiki_use_mouse = 1
let g:vimwiki_camel_case = 0
let g:vimwiki_CJK_length = 1
let g:vimwiki_use_calendar = 0
let g:vimwiki_timestamp_format='%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S'
let g:vimwiki_user_htmls = "search.html,404.html"


let develop_notes = {} " ä¸ªäººå¼€å‘ç¬”è®°
let develop_notes.path = '~/test/test/develop-notes' " ç¬”è®°è·¯å¾„
let develop_notes.syntax = 'markdown'
let develop_notes.ext = '.md'

let g:vimwiki_list = [develop_notes]
let g:vimwiki_ext2syntax = {'.md': 'markdown', '.markdown': 'markdown', '.mdown': 'markdown'}


" vim-autodoc
"let g:autodoc_display_return_type = 1 " 1è¡¨ç¤ºè¾“å‡ºè¿”å›å€¼ç±»å‹ï¼Œ0è¡¨ç¤ºä¸è¾“å‡º
"let g:autodoc_typehint_style = 'pep484' " æ³¨é‡Šé£æ ¼
"let g:autodoc_display_runtime_info = 0 " æ˜¯å¦ç»Ÿè®¡å‡½æ•°è¿è¡Œä¿¡æ¯
"map <F2> :RecordParameter<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" undotree
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
if has("persistent_undo")
	set undodir=~/.undodir/
	set undofile
endif


" Is better way to zoom windows in Vim than ZoomWin?
" Zoom / Restore window.
function! s:ZoomToggle() abort
    if exists('t:zoomed') && t:zoomed
        execute t:zoom_winrestcmd
        let t:zoomed = 0
    else
        let t:zoom_winrestcmd = winrestcmd()
        resize
        vertical resize
        let t:zoomed = 1
    endif
endfunction
command! ZoomToggle call s:ZoomToggle()
"nnoremap <silent> <Leader>z :ZoomToggle<CR>
nnoremap <silent> <c-w>z :ZoomToggle<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" UltiSnips ä»£ç ç‰‡æ®µè¡¥å…¨
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:UltiSnipsExpandTrigger       = "<c-e>"
let g:UltiSnipsJumpForwardTrigger  = "<c-j>"
let g:UltiSnipsJumpBackwardTrigger = "<c-k>"
let g:UltiSnipsSnippetsDir = '/home/asura/.vim/mysnippets'
let g:UltiSnipsSnippetDirectories=["mysnippets"]
let g:UltiSnipsEditSplit='vertical'
" å®šä¹‰å­˜æ”¾ä»£ç ç‰‡æ®µçš„æ–‡ä»¶å¤¹ .vim/UltiSnipsä¸‹ï¼Œä½¿ç”¨è‡ªå®šä¹‰å’Œé»˜è®¤çš„ï¼Œå°†ä¼šçš„åˆ°å…¨å±€ï¼Œæœ‰å†²çªçš„ä¼šæç¤º
" è¿›å…¥å¯¹åº”filetypeçš„snippetsè¿›è¡Œç¼–è¾‘
map <leader>us :UltiSnipsEdit<CR>
au FileType markdown :UltiSnipsAddFiletypes markdown

" ctrl+j/k è¿›è¡Œé€‰æ‹©
" func! g:JInYCM()
"     if pumvisible()
"         return "\<C-n>"
"     else
"         return "\<c-j>"
"     endif
" endfunction
"
" func! g:KInYCM()
"     if pumvisible()
"         return "\<C-p>"
"     else
"         return "\<c-k>"
"     endif
" endfunction
" inoremap <c-j> <c-r>=g:JInYCM()<cr>
" au BufEnter,BufRead * exec "inoremap <silent> " . g:UltiSnipsJumpBackwordTrigger . " <C-R>=g:KInYCM()<cr>"
" let g:UltiSnipsJumpBackwordTrigger = "<c-k>"

" AsyncRun
autocmd  QuickFixCmdPost  *  botright  copen  8
let g:asyncrun_encs = 'gbk'

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" é”®ä½æ˜ å°„
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
nnoremap <cr> :noh<CR><CR>:<backspace> " å–æ¶ˆæœç´¢é«˜äº®
set pastetoggle=<F3> " å¦‚æœä½ å¤åˆ¶ä»£ç æ—¶ï¼Œå®ƒå°†ä½¿ä»£ç ä¿æŒåŸå§‹ç¼©è¿›
map <leader>r :e<CR> " åˆ·æ–°æ–‡ä»¶


" jedi
let g:SuperTabDefaultCompletionType = "context"
let g:jedi#popup_on_dot = 0


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" fzf æœç´¢è®¾ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:fzf_layout = get(g:, 'fzf_layout', {'down': '~40%'})
" This is the default extra key bindings
let g:fzf_action = {
  \ 'ctrl-t': 'tab split',
  \ 'ctrl-x': 'split',
  \ 'ctrl-v': 'vsplit' }
" Customize fzf colors to match your color scheme
let g:fzf_colors =
\ { 'fg':      ['fg', 'Normal'],
  \ 'bg':      ['bg', 'Normal'],
  \ 'hl':      ['fg', 'Comment'],
  \ 'fg+':     ['fg', 'CursorLine', 'CursorColumn', 'Normal'],
  \ 'bg+':     ['bg', 'CursorLine', 'CursorColumn'],
  \ 'hl+':     ['fg', 'Statement'],
  \ 'info':    ['fg', 'PreProc'],
  \ 'border':  ['fg', 'Ignore'],
  \ 'prompt':  ['fg', 'Conditional'],
  \ 'pointer': ['fg', 'Exception'],
  \ 'marker':  ['fg', 'Keyword'],
  \ 'spinner': ['fg', 'Label'],
  \ 'header':  ['fg', 'Comment'] }
" [Buffers] Jump to the existing window if possible
let g:fzf_buffers_jump = 1

" [[B]Commits] Customize the options used by 'git log':
let g:fzf_commits_log_options = '--graph --color=always --format="%C(auto)%h%d %s %C(black)%C(bold)%cr"'

" [Tags] Command to generate tags file
let g:fzf_tags_command = 'ctags -R'

" [Commands] --expect expression for directly executing the command
let g:fzf_commands_expect = 'alt-enter,ctrl-x'
command! -bang -nargs=* Ag
  \ call fzf#vim#ag(<q-args>,
  \                 <bang>0 ? fzf#vim#with_preview('up:60%')
  \                         : fzf#vim#with_preview('right:50%:hidden', '?'),
  \                 <bang>0)
nnoremap <leader>p :FZF<CR>
nnoremap <C-f> :Ag<CR>

"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" markdown
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
let g:mkdp_path_to_chrome = "/usr/bin/chromium-browser"
let g:mkdp_auto_start = 1

" è‡ªåŠ¨è¡¥é½å¼•å·ã€æ‹¬å·
:inoremap ( ()<ESC>i
:inoremap ) <c-r>=ClosePair(')')<CR>
:inoremap { {<CR>}<ESC>O
:inoremap } <c-r>=ClosePair('}')<CR>
:inoremap [ []<ESC>i
:inoremap ] <c-r>=ClosePair(']')<CR>
:inoremap < <><ESC>i
:inoremap > <c-r>=ClosePair(']')<CR>
:inoremap " ""<ESC>i
:inoremap ' ''<ESC>i
function! ClosePair(char)
    if getline('.')[col('.') - 1] == a:char
		        return "\<Right>"
	else
			    return a:char
	endif
endfunction
